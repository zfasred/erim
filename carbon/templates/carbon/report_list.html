<!-- carbon/templates/carbon/report_list.html -->
{% extends 'base.html' %}

{% block title %}Karbon Raporlarƒ±{% endblock %}

{% block body_class %}report-list-bg{% endblock %}
{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/backgrounds.css' %}">
{% endblock %}

{% block content %}
<div class="container">
    <h1>üìä {{ list_title }}</h1>
    
    <!-- BURASI DEƒûƒ∞≈ûTƒ∞: Buton ve men√ºy√º yan yana koyduk -->
    <div style="display: flex; justify-content: space-between; align-items: center; padding: 20px 0;">
        <!-- Sol: Rapor olu≈ütur butonu -->
        <button id="generateReportBtn" onclick="handleReportGeneration()" class="btn-primary">
            üìä Rapor Olu≈ütur
        </button>
        
        <!-- Saƒü: Rapor tipi se√ßimi -->
        <select id="reportTypeSelect" style="padding: 10px; border-radius: 5px;">
            <option value="summary">√ñzet Rapor</option>
            <option value="detailed">Detaylƒ± Rapor (Word Tarzƒ±)</option>
            <option value="executive">Y√∂netici √ñzeti</option>
        </select>
    </div>
    
    <!-- MEVCUT tablo -->
    <div id="existingReportsTable">
        <table class="data-table">
            <thead>
                <tr>
                    <th>Firma</th>
                    <th>Rapor Adƒ±</th>
                    <th>D√∂nem</th>
                    <th>Toplam Emisyon</th>
                    <th>Durum</th>
                    <th>ƒ∞≈ülemler</th>
                </tr>
            </thead>
            <tbody>
                {% for report in reports %}
                <tr>
                    <td>{{ report.firm.name }}</td>
                    <td>{{ report.report_name }}</td>
                    <td>{{ report.period_start|date:"M Y" }} - {{ report.period_end|date:"M Y" }}</td>
                    <td>{{ report.total_co2e }} tCO‚ÇÇe</td>
                    <td>{{ report.get_status_display }}</td>
                    <td>
                        <a href="#" onclick="openReportEditor({{ report.id }})" class="btn-link">
                            üìù D√ºzenle
                        </a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6" style="text-align: center;">
                        Hen√ºz rapor bulunmuyor. Yukarƒ±daki butonu kullanarak rapor olu≈üturabilirsiniz.
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <!-- YENƒ∞: √ñzet rapor alanƒ± (gizli ba≈ülar) -->
    <div id="summaryReportArea" style="display: none; margin-top: 30px;">
        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
            <h2>üìä √ñzet Rapor</h2>
            <div id="summaryContent">
                <!-- √ñzet rapor i√ßeriƒüi buraya gelecek -->
            </div>
        </div>
    </div>
    
    <!-- YENƒ∞: Word edit√∂r alanƒ± (gizli ba≈ülar) -->
    <div id="wordEditorArea" style="display: none; margin-top: 30px;">
        <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
            <h2>üìù Detaylƒ± Rapor Edit√∂r√º</h2>
            
            <!-- Toolbar -->
            <div id="toolbar" style="margin-bottom: 10px;">
                <select class="ql-header">
                    <option value="1">Ba≈ülƒ±k 1</option>
                    <option value="2">Ba≈ülƒ±k 2</option>
                    <option selected>Normal</option>
                </select>
                <button class="ql-bold">Kalƒ±n</button>
                <button class="ql-italic">ƒ∞talik</button>
                <button class="ql-underline">Altƒ± √áizili</button>
                <button class="ql-list" value="ordered">Numaralƒ± Liste</button>
                <button class="ql-list" value="bullet">Madde ƒ∞≈üareti</button>
            </div>
            
            <!-- Edit√∂r -->
            <div id="editor" style="min-height: 400px; border: 1px solid #ccc; background: white;">
                <!-- ƒ∞√ßerik buraya gelecek -->
            </div>
            
            <!-- Export butonlarƒ± -->
            <div style="margin-top: 20px;">
                <button onclick="exportToPDF()" class="btn-danger">üìÑ PDF ƒ∞ndir</button>
                <button onclick="exportToWord()" class="btn-info">üìù Word ƒ∞ndir</button>
                <button onclick="closeEditor()" class="btn-secondary">‚ùå Kapat</button>
            </div>
        </div>
    </div>
</div>

<!-- Quill CSS -->
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">

<style>
    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
    }
    
    .data-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }
    
    .data-table th {
        background: #2c3e50;
        color: white;
        padding: 10px;
        text-align: left;
    }
    
    .data-table td {
        padding: 10px;
        border-bottom: 1px solid #ddd;
    }
    
    .btn-primary {
        background: #3498db;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }
    
    .btn-danger {
        background: #e74c3c;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }
    
    .btn-info {
        background: #3498db;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }
    
    .btn-secondary {
        background: #95a5a6;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }
    
    .btn-link {
        color: #3498db;
        text-decoration: none;
    }
    
    .btn-link:hover {
        text-decoration: underline;
    }
</style>

<!-- Quill JS -->
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

<script>
let quill = null;

function handleReportGeneration() {
    const reportType = document.getElementById('reportTypeSelect').value;
    
    // Tabloyu gizle
    document.getElementById('existingReportsTable').style.display = 'none';
    
    if (reportType === 'summary') {
        // √ñzet rapor g√∂ster
        showSummaryReport();
    } else if (reportType === 'detailed') {
        // Word edit√∂r g√∂ster
        showWordEditor();
    } else if (reportType === 'executive') {
        alert('Y√∂netici √ñzeti yakƒ±nda eklenecek!');
    }
}

function showSummaryReport() {
    // Word edit√∂r√º gizle
    document.getElementById('wordEditorArea').style.display = 'none';
    
    // √ñzet rapor alanƒ±nƒ± g√∂ster
    document.getElementById('summaryReportArea').style.display = 'block';
    
    // √ñrnek √∂zet rapor i√ßeriƒüi
    document.getElementById('summaryContent').innerHTML = `
        <table class="data-table">
            <tr>
                <td><strong>Firma:</strong></td>
                <td>Test Firma</td>
            </tr>
            <tr>
                <td><strong>D√∂nem:</strong></td>
                <td>Ocak - Aralƒ±k 2025</td>
            </tr>
            <tr>
                <td><strong>Kapsam 1:</strong></td>
                <td>8,536.45 tCO‚ÇÇe</td>
            </tr>
            <tr>
                <td><strong>Kapsam 2:</strong></td>
                <td>3,516.12 tCO‚ÇÇe</td>
            </tr>
            <tr>
                <td><strong>Kapsam 3:</strong></td>
                <td>12,450.67 tCO‚ÇÇe</td>
            </tr>
            <tr>
                <td><strong>Kapsam 4:</strong></td>
                <td>16,102.43 tCO‚ÇÇe</td>
            </tr>
            <tr style="background: #ecf0f1;">
                <td><strong>TOPLAM:</strong></td>
                <td><strong>40,605.67 tCO‚ÇÇe</strong></td>
            </tr>
        </table>
    `;
}

function showWordEditor() {
    // √ñzet raporu gizle
    document.getElementById('summaryReportArea').style.display = 'none';
    
    // Word edit√∂r√º g√∂ster
    document.getElementById('wordEditorArea').style.display = 'block';
    
    // Quill edit√∂r√º ba≈ülat
    if (!quill) {
        quill = new Quill('#editor', {
            theme: 'snow',
            modules: {
                toolbar: '#toolbar'
            }
        });
    }
    
    // √ñrnek i√ßerik y√ºkle
    const sampleContent = `
        <h1>Karbon Ayak ƒ∞zi Raporu</h1>
        <p><strong>Firma:</strong> Test Firma</p>
        <p><strong>D√∂nem:</strong> Ocak - Aralƒ±k 2025</p>
        
        <h2>1. Y√∂netici √ñzeti</h2>
        <p>Bu rapor, firmanƒ±zƒ±n 2025 yƒ±lƒ± karbon ayak izi hesaplamalarƒ±nƒ± i√ßermektedir.</p>
        
        <h2>2. Kapsam Bazlƒ± Emisyonlar</h2>
        <p>‚Ä¢ Kapsam 1: 8,536.45 tCO‚ÇÇe</p>
        <p>‚Ä¢ Kapsam 2: 3,516.12 tCO‚ÇÇe</p>
        <p>‚Ä¢ Kapsam 3: 12,450.67 tCO‚ÇÇe</p>
        <p>‚Ä¢ Kapsam 4: 16,102.43 tCO‚ÇÇe</p>
        
        <h2>3. Sonu√ß</h2>
        <p>Toplam karbon emisyonunuz: <strong>40,605.67 tCO‚ÇÇe</strong></p>
    `;
    
    quill.clipboard.dangerouslyPasteHTML(sampleContent);
}

function closeEditor() {
    // Her ≈üeyi gizle, tabloyu g√∂ster
    document.getElementById('wordEditorArea').style.display = 'none';
    document.getElementById('summaryReportArea').style.display = 'none';
    document.getElementById('existingReportsTable').style.display = 'block';
}

function exportToPDF() {
    window.print(); // Basit √ß√∂z√ºm
}

function exportToWord() {
    const content = quill.root.innerHTML;
    const blob = new Blob([content], { type: 'application/msword' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'Karbon_Raporu.doc';
    a.click();
}

function openReportEditor(reportId) {
    // ƒ∞leride implement edilecek
    alert('Rapor #' + reportId + ' d√ºzenleme √∂zelliƒüi yakƒ±nda!');
}
</script>
{% endblock %}